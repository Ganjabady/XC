<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>V2XCore | داشبورد کانفیگ‌های رایگان</title>
    <!-- Chosen Palette: Midnight Blue & Electric Cyan -->
    <!-- Application Structure Plan: A single-page dashboard application designed for optimal user flow. The structure prioritizes immediate access to key information and actions. 1. Header: Clean navigation and branding. 2. Hero Section: Displays vital stats (total configs, last update) and primary subscription links for quick access. 3. Tabbed Main Section: Organizes content logically into user tasks: "All Configs" for browsing, "By Country" for regional filtering, and "Subscription Links" for advanced users. This task-oriented, tabbed structure is more intuitive than a static sidebar, guiding the user through exploration without overwhelming them. 4. Footer: Essential links. This architecture makes the most critical data immediately accessible while keeping detailed views organized and just a click away. -->
    <!-- Visualization & Content Choices: 1. Report Info: Full list of V2Ray configs. Goal: Allow easy browsing, copying, and QR code generation. Viz/Method: Interactive HTML table. Interaction: Live search/filter, one-click copy, and modal QR code display. Justification: A searchable table is the most efficient way to handle a large list of text-based data. Library: Vanilla JS, qrcode.js. 2. Report Info: Geographic distribution of servers. Goal: Provide a quick visual overview of server locations. Viz/Method: Horizontal Bar Chart. Interaction: Tooltips showing exact counts on hover. Justification: A bar chart is excellent for comparing categorical data (countries). Library: Chart.js. 3. Report Info: All subscription links (main, base64, per-protocol, per-region). Goal: Centralize all subscription options for easy access. Viz/Method: Grouped lists within cards. Interaction: One-click copy buttons for each URL. Justification: Grouping and clear copy actions reduce user effort. Library: Vanilla JS. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <style>
        body { font-family: 'Vazirmatn', sans-serif; background-color: #020617; color: #cbd5e1; }
        .card { background-color: #0f172a; border: 1px solid #1e293b; }
        .btn-primary { background-color: #0891b2; color: white; }
        .btn-secondary { background-color: #334155; color: #e2e8f0; }
        .tab-active { color: #06b6d4; border-color: #06b6d4; }
        .modal-backdrop { background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(4px); }
        .chart-container { position: relative; width: 100%; max-width: 800px; margin-left: auto; margin-right: auto; height: 400px; max-height: 60vh; }
        .config-card:hover { transform: translateY(-4px); box-shadow: 0 10px 25px -5px rgba(6, 182, 212, 0.1), 0 8px 10px -6px rgba(6, 182, 212, 0.1); }
    </style>
</head>
<body class="antialiased">

    <!-- Modal QR Code -->
    <div id="qr-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden transition-opacity duration-300 opacity-0">
        <div id="qr-modal-content" class="card rounded-2xl shadow-2xl p-6 w-full max-w-sm text-center transform transition-all duration-300 scale-95">
            <h3 class="text-xl font-bold mb-4 text-white">اسکن کنید</h3>
            <div id="qrcode" class="flex justify-center items-center p-2 bg-white rounded-lg mx-auto w-64 h-64"></div>
            <button id="close-modal-btn" class="mt-6 w-full btn-secondary font-bold py-2 px-4 rounded-lg transition-colors">بستن</button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container mx-auto p-4 md:p-6">

        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <div class="flex items-center gap-3">
                <i class='bx bxs-zap text-4xl text-cyan-400'></i>
                <h1 class="text-3xl font-bold text-white">V2XCore</h1>
            </div>
            <a href="https://github.com/Ganjabady/XC" target="_blank" class="px-4 py-2 text-sm font-semibold text-slate-300 hover:text-white hover:bg-slate-700/50 rounded-lg transition-colors flex items-center gap-2">
                <i class='bx bxl-github text-xl'></i> مشاهده در گیت‌هاب
            </a>
        </header>

        <!-- Tab Navigation -->
        <div class="mb-8 flex justify-center border-b border-slate-800">
            <button data-tab="dashboard" class="tab-btn px-6 py-3 text-lg font-semibold border-b-2 border-transparent transition-colors tab-active">داشبورد</button>
            <button data-tab="all-configs" class="tab-btn px-6 py-3 text-lg font-semibold border-b-2 border-transparent transition-colors">لیست کانفیگ‌ها</button>
            <button data-tab="links" class="tab-btn px-6 py-3 text-lg font-semibold border-b-2 border-transparent transition-colors">لینک‌های اشتراک</button>
        </div>

        <!-- Main Content -->
        <main>
            <!-- Dashboard Tab -->
            <div id="tab-dashboard" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 card p-6 rounded-2xl shadow-lg">
                        <h3 class="text-xl font-bold text-white mb-6">توزیع سرورها بر اساس کشور</h3>
                        <div class="chart-container">
                            <canvas id="country-chart"></canvas>
                        </div>
                    </div>
                    <div class="space-y-6">
                        <div class="card p-6 rounded-2xl shadow-lg">
                            <h3 class="text-xl font-bold text-white mb-4">آمار کلی</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center"><span class="text-slate-400">تعداد کل کانفیگ‌های سالم:</span><span id="total-configs-stat" class="font-bold text-lg text-green-400">...</span></div>
                                <div class="flex justify-between items-center"><span class="text-slate-400">آخرین بروزرسانی سرور:</span><span id="last-update-stat" class="font-mono text-sm">...</span></div>
                            </div>
                        </div>
                        <div class="card p-6 rounded-2xl shadow-lg">
                            <h3 class="text-xl font-bold text-white mb-4">لینک‌های اصلی</h3>
                            <div class="space-y-3" id="main-subs-list-dashboard"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- All Configs Tab -->
            <div id="tab-all-configs" class="tab-content hidden">
                <div class="card p-4 sm:p-6 rounded-2xl shadow-lg">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
                        <h3 class="text-xl font-bold text-slate-900 dark:text-white">لیست کامل کانفیگ‌ها</h3>
                        <div class="relative w-full sm:w-64">
                            <i class='bx bx-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400'></i>
                            <input type="text" id="search-input" placeholder="جستجو بر اساس نام..." class="w-full bg-slate-800/50 border-2 border-slate-700 focus:border-cyan-500 rounded-lg py-3 pl-12 pr-4 outline-none transition-colors">
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-right">
                            <thead class="text-sm text-slate-500 dark:text-slate-400 border-b-2 border-slate-700">
                                <tr>
                                    <th class="p-4">#</th>
                                    <th class="p-4">نام کانفیگ</th>
                                    <th class="p-4 text-center">پروتکل</th>
                                    <th class="p-4 text-center">عملیات</th>
                                </tr>
                            </thead>
                            <tbody id="config-table-body">
                                <!-- Rows will be inserted by JS -->
                            </tbody>
                        </table>
                        <div id="loading-spinner" class="text-center py-12">
                            <i class='bx bx-loader-alt bx-spin text-4xl text-sky-500'></i>
                            <p class="mt-2">در حال بارگذاری کانفیگ‌ها...</p>
                        </div>
                         <div id="no-results" class="text-center py-12 hidden">
                            <i class='bx bx-error-circle text-4xl text-amber-500'></i>
                            <p class="mt-2">موردی یافت نشد.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- All Links Tab -->
            <div id="tab-links" class="tab-content hidden">
                 <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="card p-6 rounded-2xl shadow-lg">
                        <h3 class="text-xl font-bold mb-4 text-white flex items-center gap-2"><i class='bx bx-link-alt'></i>لینک‌های اصلی</h3>
                        <div class="space-y-3" id="main-subs-list"></div>
                    </div>
                    <div class="card p-6 rounded-2xl shadow-lg">
                        <h3 class="text-xl font-bold mb-4 text-white flex items-center gap-2"><i class='bx bx-network-chart'></i>بر اساس پروتکل</h3>
                         <div class="space-y-3" id="protocol-subs-list"></div>
                    </div>
                    <div class="card p-6 rounded-2xl shadow-lg">
                        <h3 class="text-xl font-bold mb-4 text-white flex items-center gap-2"><i class='bx bx-world'></i>بر اساس کشور</h3>
                         <div class="space-y-3 overflow-y-auto max-h-96" id="region-subs-list"></div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="text-center mt-12 text-slate-500 text-sm"><p>ساخته شده با ❤️ و ☕️</p></footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const REPO_BASE_URL = "https://raw.githubusercontent.com/Ganjabady/XC/main";
            const ALL_CONFIGS_URL = `${REPO_BASE_URL}/subscriptions/v2ray/all_sub.txt`;
            const STATS_URL = `${REPO_BASE_URL}/reports/stats.json`;

            const elements = {
                searchInput: document.getElementById('search-input'),
                tableBody: document.getElementById('config-table-body'),
                loadingSpinner: document.getElementById('loading-spinner'),
                noResults: document.getElementById('no-results'),
                qrModal: document.getElementById('qr-modal'),
                qrModalContent: document.getElementById('qr-modal-content'),
                qrcodeContainer: document.getElementById('qrcode'),
                closeModalBtn: document.getElementById('close-modal-btn'),
                tabs: document.querySelectorAll('.tab-btn'),
                tabContents: document.querySelectorAll('.tab-content'),
                totalConfigsStatDash: document.getElementById('total-configs-stat'),
                lastUpdateStatDash: document.getElementById('last-update-stat'),
                countryChartCanvas: document.getElementById('country-chart'),
                mainSubsListDashboard: document.getElementById('main-subs-list-dashboard'),
                mainSubsList: document.getElementById('main-subs-list'),
                protocolSubsList: document.getElementById('protocol-subs-list'),
                regionSubsList: document.getElementById('region-subs-list'),
            };

            let allConfigsData = [];
            let countryChart = null;

            function parseConfig(link) {
                try {
                    if (!link.includes("://")) return null;
                    const url = new URL(link);
                    const name = decodeURIComponent(url.hash.substring(1)) || url.hostname;
                    return { link, name, protocol: url.protocol.replace(':', '') };
                } catch (e) { return null; }
            }

            async function loadAllData() {
                try {
                    const [configsResponse, statsResponse] = await Promise.all([
                        fetch(ALL_CONFIGS_URL),
                        fetch(STATS_URL)
                    ]);
                    if (!configsResponse.ok) throw new Error('Failed to fetch configs');
                    
                    const configsText = await configsResponse.text();
                    allConfigsData = configsText.split('\n').filter(Boolean).map((line, index) => ({
                        id: index + 1,
                        ...parseConfig(line)
                    }));

                    if (statsResponse.ok) {
                        const stats = await statsResponse.json();
                        updateDashboard(stats);
                        renderSubscriptionLinks(stats);
                    }

                    renderTable(allConfigsData);

                } catch (error) {
                    console.error('Error fetching data:', error);
                    elements.tableBody.innerHTML = `<tr><td colspan="4" class="text-center p-8 text-red-500">خطا در بارگذاری اطلاعات.</td></tr>`;
                } finally {
                    elements.loadingSpinner.classList.add('hidden');
                }
            }

            function renderTable(configs) {
                elements.tableBody.innerHTML = '';
                if (configs.length === 0) {
                    elements.noResults.classList.remove('hidden');
                    return;
                }
                elements.noResults.classList.add('hidden');
                configs.forEach(config => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-slate-800 hover:bg-slate-800/50';
                    const protocol = config.protocol.toUpperCase();
                    const badgeColor = { VLESS: 'bg-blue-500/20 text-blue-300', VMESS: 'bg-purple-500/20 text-purple-300', TROJAN: 'bg-red-500/20 text-red-300', SS: 'bg-orange-500/20 text-orange-300' }[protocol] || 'bg-slate-500/20 text-slate-300';
                    row.innerHTML = `
                        <td class="p-4 font-mono text-slate-500">${config.id.toString().padStart(4, '0')}</td>
                        <td class="p-4 font-semibold text-white">${config.name}</td>
                        <td class="p-4 text-center"><span class="px-3 py-1 text-xs font-bold rounded-full ${badgeColor}">${protocol}</span></td>
                        <td class="p-4 text-center"><div class="flex justify-center items-center gap-1"><button class="copy-btn p-2 rounded-full hover:bg-slate-700 text-slate-400" data-link="${config.link}" title="کپی"><i class='bx bx-copy text-lg'></i></button><button class="qr-btn p-2 rounded-full hover:bg-slate-700 text-slate-400" data-link="${config.link}" title="QR کد"><i class='bx bx-qr text-lg'></i></button></div></td>
                    `;
                    elements.tableBody.appendChild(row);
                });
            }

            function updateDashboard(stats) {
                elements.totalConfigsStatDash.textContent = stats.total_configs;
                elements.lastUpdateStatDash.textContent = new Date(stats.update_time).toLocaleString('fa-IR', { day: 'numeric', month: 'long', hour: '2-digit', minute: '2-digit' });
                renderCountryChart(stats.countries);
            }
            
            function createSubLinkItem(title, url) {
                return `<div class="flex items-center justify-between p-3 rounded-lg bg-slate-800/50"><span class="font-semibold">${title}</span><button class="copy-btn p-2 rounded-full hover:bg-slate-700 text-slate-400" data-link="${url}" title="کپی"><i class='bx bx-copy text-xl'></i></button></div>`;
            }

            function renderSubscriptionLinks(stats) {
                const mainSubUrl = `${REPO_BASE_URL}/subscriptions/v2ray/all_sub.txt`;
                const base64SubUrl = `${REPO_BASE_URL}/subscriptions/base64/all_sub.txt`;
                
                let mainSubsHtml = createSubLinkItem('لینک کامل', mainSubUrl) + createSubLinkItem('لینک Base64', base64SubUrl);
                elements.mainSubsListDashboard.innerHTML = mainSubsHtml;
                elements.mainSubsList.innerHTML = mainSubsHtml;

                let protocolHtml = '';
                ['vless', 'vmess', 'trojan', 'ss'].forEach(p => {
                    const url = `${REPO_BASE_URL}/subscriptions/filtered/subs/${p}.txt`;
                    protocolHtml += createSubLinkItem(p.toUpperCase(), url);
                });
                elements.protocolSubsList.innerHTML = protocolHtml;

                let regionHtml = '';
                const sortedCountries = Object.keys(stats.countries).sort();
                sortedCountries.forEach(c => {
                    if (c !== "Unknown") {
                        const url = `${REPO_BASE_URL}/subscriptions/regions/${c}.txt`;
                        regionHtml += createSubLinkItem(c, url);
                    }
                });
                elements.regionSubsList.innerHTML = regionHtml;
            }

            function renderCountryChart(countries) {
                if (countryChart) countryChart.destroy();
                const sorted = Object.entries(countries).sort(([,a],[,b]) => b-a).slice(0, 15);
                const labels = sorted.map(c => c[0]);
                const data = sorted.map(c => c[1]);
                const ctx = elements.countryChartCanvas.getContext('2d');
                countryChart = new Chart(ctx, {
                    type: 'bar', data: { labels, datasets: [{ label: 'تعداد سرورها', data, backgroundColor: 'rgba(34, 211, 238, 0.5)', borderColor: 'rgba(34, 211, 238, 1)', borderWidth: 1, borderRadius: 5 }] },
                    options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { rtl: true, bodyFont: { family: 'Vazirmatn' }, titleFont: { family: 'Vazirmatn' } } }, scales: { x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' } }, y: { ticks: { color: '#94a3b8' }, grid: { display: false } } } }
                });
            }

            elements.searchInput.addEventListener('input', () => {
                const searchTerm = elements.searchInput.value.toLowerCase();
                Array.from(elements.tableBody.children).forEach(row => {
                    const name = row.children[1].textContent.toLowerCase();
                    row.style.display = name.includes(searchTerm) ? '' : 'table-row';
                });
            });

            document.body.addEventListener('click', e => {
                const copyBtn = e.target.closest('.copy-btn');
                if (copyBtn) {
                    navigator.clipboard.writeText(copyBtn.dataset.link).then(() => {
                        const originalIcon = copyBtn.innerHTML;
                        copyBtn.innerHTML = "<i class='bx bxs-check-circle text-lg text-green-500'></i>";
                        setTimeout(() => { copyBtn.innerHTML = originalIcon; }, 1500);
                    });
                }
                const qrBtn = e.target.closest('.qr-btn');
                if (qrBtn) {
                    elements.qrcodeContainer.innerHTML = '';
                    new QRCode(elements.qrcodeContainer, { text: qrBtn.dataset.link, width: 256, height: 256, colorDark : "#e2e8f0", colorLight : "#0f172a" });
                    elements.qrModal.classList.remove('hidden');
                    setTimeout(() => { elements.qrModal.classList.add('opacity-100'); elements.qrModalContent.classList.remove('scale-95'); }, 10);
                }
            });

            elements.closeModalBtn.addEventListener('click', () => {
                elements.qrModalContent.classList.add('scale-95');
                elements.qrModal.classList.remove('opacity-100');
                setTimeout(() => elements.qrModal.classList.add('hidden'), 300);
            });

            elements.tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    elements.tabs.forEach(t => t.classList.remove('tab-active'));
                    tab.classList.add('tab-active');
                    elements.tabContents.forEach(content => content.classList.add('hidden'));
                    document.getElementById(`tab-${tab.dataset.tab}`).classList.remove('hidden');
                });
            });

            loadAllData();
        });
    </script>
</body>
</html>
